<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 移动端h5适配 · greatboy的博客</title><meta name="description" content="移动端h5适配 - greatboy"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://greatboy.github.io/atom.xml" title="greatboy的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/5241534083" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/greatboy" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">移动端h5适配</h1><div class="post-info">Jan 13, 2015</div><div class="post-content"><blockquote>
<p>未来肯定是移动端的天下，接下来谈谈h5移动端的布局问题，目前有三种<br>1、百分比布局 —–&gt;有点兼容性好，缺点布局的时候需要计算比较麻烦，不过可以采取工具或脚本实现。<br>2、flex布局  —–&gt;目前看来兼容还是有一定问题，尤其是低版本andriod<br>3、rem布局   —–&gt;目前比较推崇的布局方案，感兴趣的可以看看<a href="http://www.cocoachina.com/webapp/20150617/12190.html" target="_blank" rel="external">淘宝的flexible</a></p>
</blockquote>
<a id="more"></a>
<h3 id="我的布局方案"><a href="#我的布局方案" class="headerlink" title="我的布局方案"></a>我的布局方案</h3><h4 id="一、定宽布局"><a href="#一、定宽布局" class="headerlink" title="一、定宽布局"></a>一、定宽布局</h4><p><em>我先解释一下原理，由于以前的机器是320**XXX的分辨率，所以我采取的320布局，图片当然要做2倍图或者3倍图，就是说320px是我们的布局基础。例如iphone5是640</em>1136px，但是我们用js获取的实际宽度是320*568，也就是说屏幕相当于一个点，由两个像素，如果这个点由显示的像素越多，屏幕就约清晰。</p>
<p>例如一个新的设计图是640<em>1136的iphone5，其实机子的实际宽度是320</em>568。我们可以按照320宽度进行布局，也就是说所有的图片我们需要用宽度或者背景宽度来控制。这样即可以采用ihpone 5可以采用，2倍图标，iphone6 3倍图标。</p>
<p>这样我们其实是把宽度写死了，也就是说在机子上的宽度显示的永远是320px的。这里我们就要想法进行缩放去适配各种不同机子，也就是rem方式。rem其实是相对于根节点的font-size大小进行缩放，也就是默认情况下1rem=16px。那么我们的320px=20rem，也就是布局的时候我们写20rem。这时候我们需要把html的font-size计算成需要的大小，就可以适配机器了。</p>
<p>代码如下<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">id</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"format-detection"</span> <span class="attr">content</span>=<span class="string">"telephone=no"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>GreatBoy<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line">            /*-----css Reset end-----*/</div><div class="line">            body,h1,h2,h3,h4,h5,h6,p,ul,ol,form&#123;</div><div class="line">                margin:0;</div><div class="line">                padding:0px;</div><div class="line">            &#125;</div><div class="line">            html&#123;</div><div class="line">                display: none;</div><div class="line">            &#125;</div><div class="line">            .nav img&#123;</div><div class="line">                width:10rem;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nav"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://p1.jmstatic.com/banner/75/mobile_app/24326_0.jpg"</span>/&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"user"</span>&gt;</span>用户信息<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"userinfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">        (function(win) &#123;</div><div class="line">            var doc = win.document,</div><div class="line">                scale = 16,</div><div class="line">                $body = doc.getElementsByTagName('body')[0],</div><div class="line">                $html = doc.getElementsByTagName('html')[0],</div><div class="line">                windowWidth = doc.documentElement &amp;&amp; doc.documentElement.clientWidth || doc.body.clientWidth || win.innerWidth,</div><div class="line">                windowHeight = document.documentElement &amp;&amp; document.documentElement.clientHeight || documentElement.body.clientHeight || window.innerHeight,</div><div class="line">                deviceAgent = navigator.userAgent.toLowerCase();</div><div class="line">            if ( deviceAgent.match( /(iphone|ipod|ipad|android|windows\s*phone|symbianos)/ ) ) &#123;</div><div class="line">                try&#123;</div><div class="line">                    if ( window.localStorage &amp;&amp; window.localStorage.getItem('scale_greatboy') ) &#123;</div><div class="line">                        scale = window.localStorage.getItem('scale_greatboy');</div><div class="line">                    &#125; else &#123;</div><div class="line">                        scale = parseFloat(windowWidth * 16 / 320);</div><div class="line">                        if (windowHeight &gt; windowWidth) &#123;</div><div class="line">                            window.localStorage &amp;&amp; window.localStorage.setItem('scale_greatboy', scale);</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;catch(e)&#123;&#125;</div><div class="line">                if (deviceAgent.match(/android\s*2.3/) &amp;&amp; deviceAgent.match(/micromessenger/)) &#123;</div><div class="line">                    scale = 16;</div><div class="line">                &#125;</div><div class="line">                $html.style.fontSize = scale + 'px';</div><div class="line">                $html.style.display = 'block';</div><div class="line">            &#125; else &#123;</div><div class="line">                window.onresize = function()&#123;</div><div class="line">                    windowWidth = doc.documentElement &amp;&amp; doc.documentElement.clientWidth || doc.body.clientWidth || win.innerWidth;</div><div class="line">                    scale = parseFloat(windowWidth * 16 / 320);</div><div class="line">                    $html.style.fontSize = scale + 'px';</div><div class="line">                &#125;;</div><div class="line">                scale = parseFloat(windowWidth * 16 / 320);</div><div class="line">                $html.style.fontSize = scale + 'px';</div><div class="line">                $html.style.display = 'block';</div><div class="line">            &#125;</div><div class="line">            $body.style.width = '20rem';</div><div class="line">        &#125;)(window);</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>这种布局目前已经可以适配大部分手机，除非是不支持rem的手机，但是还会有问题，就是16px = 1rem，这样每次我们布局的时候量的宽度都是px的，还的转换成rem，这里其实可以采取很多方案，例如发布的时候编译，以及用css的一些插件来实现。当时我们采取的是发布的时候用node来写了一个插件做这个事情。fis的插件如</p>
<h4 id="二、定宽布局的改良"><a href="#二、定宽布局的改良" class="headerlink" title="二、定宽布局的改良"></a>二、定宽布局的改良</h4><p>说起改良后的方法还的感谢猫眼的前端技术经理，有一次面试跟猫眼的前端技术经理聊rem布局的时候聊出来的，他给的建议是如果写成320=20rem，这种方式不好计算，那么不如直接写320px = 3.2rem，回头一想其实也是可以的，我们只需要在根节点的font-size做处理就好。   320=20rem其实是1rem=16px,那么如果是320px = 3.2rem，那么其实相当于1rem = 100px，也就是说需要把1rem=16px转换成1rem=100px而已。于似乎出现下面的代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">id</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"format-detection"</span> <span class="attr">content</span>=<span class="string">"telephone=no"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>GreatBoy<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line">            /*-----css Reset end-----*/</div><div class="line">            body,h1,h2,h3,h4,h5,h6,p,ul,ol,form&#123;</div><div class="line">                margin:0;</div><div class="line">                padding:0px;</div><div class="line">            &#125;</div><div class="line">            body&#123;</div><div class="line">                font-size: 14px;</div><div class="line">            &#125;</div><div class="line">            .nav img&#123;</div><div class="line">                width: 100%;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nav"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://p1.jmstatic.com/banner/75/mobile_app/24326_0.jpg"</span>/&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"user"</span>&gt;</span>用户信息<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"userinfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line">            (function(win) &#123;</div><div class="line">                var doc = win.document,</div><div class="line">                scale = 16,</div><div class="line">                $body = doc.getElementsByTagName('body')[0],</div><div class="line">                $html = doc.getElementsByTagName('html')[0],</div><div class="line">                windowWidth = doc.documentElement &amp;&amp; doc.documentElement.clientWidth || doc.body &amp;&amp; doc.body.clientWidth || win.innerWidth,</div><div class="line">                windowHeight = doc.documentElement &amp;&amp; doc.documentElement.clientHeight || doc.body &amp;&amp; doc.body.clientHeight || window.innerHeight,</div><div class="line">                deviceAgent = navigator.userAgent.toLowerCase();</div><div class="line">	            if ( deviceAgent.match( /(iphone|ipod|ipad|android|windows\s*phone|symbianos)/ ) ) &#123;</div><div class="line">	                scale = parseFloat(windowWidth * 16 / (16*3.2));</div><div class="line">	                if (deviceAgent.match(/android\s*2.3/) &amp;&amp; deviceAgent.match(/micromessenger/)) &#123;</div><div class="line">	                    scale = 16;</div><div class="line">	                &#125;</div><div class="line">	                $html.style.fontSize = scale + 'px';</div><div class="line">	                $html.style.display = 'block';</div><div class="line">	            &#125; else &#123;</div><div class="line">	                window.onresize = function()&#123;</div><div class="line">	                    windowWidth = doc.documentElement &amp;&amp; doc.documentElement.clientWidth || doc.body.clientWidth || win.innerWidth;</div><div class="line">	                    scale = parseFloat(windowWidth * 16 / (16*3.2));</div><div class="line">	                    $html.style.fontSize = scale + 'px';</div><div class="line">	                &#125;;</div><div class="line">	                scale = parseFloat(windowWidth * 16 / (16*3.2));</div><div class="line">	                if(scale &gt; 150)&#123;</div><div class="line">	                    scale = 150;</div><div class="line">	                &#125;</div><div class="line">	                $html.style.fontSize = scale + 'px';</div><div class="line">	                $html.style.display = 'block';</div><div class="line">	            &#125;</div><div class="line">	            $body.style.width = '3.2rem';</div><div class="line">	            $body.style.margin = '0px auto';</div><div class="line">	        &#125;)(window);</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>为了移动端布局，我也尝试了很多方法，目前这种方法比较好，可以适配大多数手机，但是缺点就是ipad上显示比较悲剧，因为是完全缩放的，所以我目前写死了缩放系数。也就是在pc上的缩放系数定死了。<a href="https://github.com/GreatBoy/h5-rem" target="_blank" rel="external">github</a></p>
<div class="tip"><br>把我上面的代码放到你的页面，然后你可以进行布局了，以320为基础，也就是设计图需要改到320大小进行量尺寸，320px写成3.2rem，100px写成1rem，10px写成0.1rem，需要注意的是图片需要控制，并且图片需要320的二倍图或者三倍图。<br></div>


</div></article></div></section><footer><div class="paginator"><a href="/2016/04/16/vue/" class="prev">PREV</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'seansun';
var disqus_identifier = '2015/01/13/hello-world/';
var disqus_title = '移动端h5适配';
var disqus_url = 'http://greatboy.github.io/2015/01/13/hello-world/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2016 <a href="http://greatboy.github.io">greatboy</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>